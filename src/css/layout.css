/* --- LAYOUT E ESTRUTURA --- */
#frame { position: fixed; inset: 12px; display: flex; flex-direction: column; overflow: hidden; z-index: 1; }

body.desktop-locked {
  overflow-x: hidden;
  overflow-y: hidden;
}

body.desktop-locked #frame {
  inset: 12px;
  left: auto;
  top: auto;
  width: auto;
  height: auto;
  transform: none;
  transform-origin: center center;
}

.logo-area {
  position: absolute; top: 10px; left: calc(var(--hud-w) + var(--gap)); right: 24px;
  display: flex; align-items: center; gap: 15px; z-index: 10; height: 30px; overflow: hidden;
  cursor: pointer;
}
.logo-dot {
  width: 22px;
  height: 22px;
  border-radius: 999px;
  border: 1px solid var(--color-accent-dim);
  background: transparent;
  color: var(--color-accent);
  font-size: 18px;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  opacity: 0.6;
  cursor: pointer;
}
.logo-dot .icon {
  width: 16px;
  height: 16px;
  stroke: currentColor;
  fill: none;
}
.logo-dot:hover { opacity: 1; }

.hud {
  position: absolute; left: 0; top: 80px; bottom: 80px; width: var(--hud-w);
  display: flex; flex-direction: column; align-items: center; gap: 18px; 
  padding-top: 20px; z-index: 40; 
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  /* Sem borda lateral dura, apenas o fim do background */
  overflow-y: auto;
  overflow-x: hidden;
  overscroll-behavior: contain;
  opacity: 1;
}
.hud-separator {
  width: 18px;
  height: 1px;
  background: var(--color-accent-dim);
  margin: 4px 0;
  opacity: 0.6;
}

.drawer {
    position: absolute; left: var(--hud-w); top: 80px; bottom: 80px;
    width: 0; background: var(--bg-drawer); 
    
    /* Borda sutil + Sombra flutuante */
    border-right: none;
    box-shadow: none;
    
    border-top-right-radius: var(--radius);
    border-bottom-right-radius: var(--radius);
    
    overflow: hidden; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 35; display: flex; flex-direction: column; 
    backdrop-filter: blur(12px); /* Blur mais forte */
}
.drawer.open { 
  width: var(--drawer-w); 
  border-right: var(--border-style);
  box-shadow: var(--shadow-float);
}
.drawer-header { height: 50px; border-bottom: var(--border-style); display: flex; align-items: center; justify-content: center; padding: 0 15px; flex-shrink: 0; position: relative; }
#closeDrawer { position: absolute; right: 12px; }
.drawer-content { flex: 1; padding: 16px; overflow-y: auto; opacity: 0; transition: opacity 0.2s; }
.drawer.open .drawer-content { opacity: 1; }
.drawer-content#panelMemo { display: flex; flex-direction: column; gap: 10px; }
.mobile-memo-actions { display: none; margin-top: 12px; }
.mobile-only { display: none; }
.desktop-only { display: block; }

/* GATILHO MOBILE */
.mobile-trigger {
    display: none; position: absolute; left: 0; top: 50%; transform: translateY(-50%);
    width: 16px; height: 48px; background: rgba(244, 241, 234, 0.06); color: var(--color-accent);
    border-radius: 0 8px 8px 0;
    justify-content: center; align-items: center; cursor: pointer; z-index: 50;
    box-shadow: 1px 0 8px rgba(0,0,0,0.35);
    border: 1px solid rgba(244, 241, 234, 0.12);
    opacity: 0;
    pointer-events: none;
}
.mobile-trigger svg { display: none; }
.mobile-trigger::before {
    content: "";
    width: 8px;
    height: 22px;
    background:
        linear-gradient(var(--color-accent), var(--color-accent)) 0 0 / 100% 2px,
        linear-gradient(var(--color-accent), var(--color-accent)) 0 10px / 100% 2px,
        linear-gradient(var(--color-accent), var(--color-accent)) 0 20px / 100% 2px;
    background-repeat: no-repeat;
    display: block;
    opacity: 0.7;
}
body.mobile-hud-open .mobile-trigger,
body.drawer-open .mobile-trigger {
    opacity: 0;
    pointer-events: none;
}
body.mobile-edge .mobile-trigger {
    opacity: 0.55;
    pointer-events: auto;
}
body.mobile-typing .mobile-trigger {
    opacity: 0.2;
    pointer-events: auto;
}

/* MOBILE CONTROLS MODAL */
.mobile-controls-trigger {
    display: none;
    position: absolute;
    left: 50%;
    bottom: 10px;
    transform: translateX(-50%);
    width: 44px;
    height: 32px;
    border-radius: 10px;
    border: 1px solid rgba(244, 241, 234, 0.2);
    background: rgba(244, 241, 234, 0.05);
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    padding: 6px 8px;
    z-index: 60;
}
.mobile-controls-trigger span {
    display: block;
    height: 2px;
    margin: 4px 0;
    background: var(--color-accent);
    opacity: 0.75;
}
.mobile-controls-close {
    display: none;
    align-self: flex-end;
    width: 34px;
    height: 34px;
    border-radius: 10px;
    margin-bottom: 10px;
}
.controls-inner .mobile-controls-close { display: none !important; }

.drawer-actions-panel {
    display: grid;
    gap: 14px;
}
.drawer-section-title {
    font-size: 11px;
    letter-spacing: 1.6px;
    text-transform: uppercase;
    color: var(--color-muted);
}
.drawer-actions-grid {
    display: grid;
    gap: 8px;
}
.drawer-actions-grid .btn-full {
    opacity: 0.8;
}
.drawer-actions-grid .btn-full:nth-child(-n+3) {
    opacity: 1;
}
.drawer-search {
    display: grid;
    gap: 8px;
}
.drawer-search-row {
    display: grid;
    grid-template-columns: 20px 1fr auto;
    gap: 8px;
    align-items: center;
}
.drawer-search-row .search-input {
    border: none;
}
.drawer-search-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
}
.drawer-tabs-mobile {
    display: none;
}
.drawer-tab-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 42px;
    height: 42px;
    border-radius: 12px;
    border: none;
    background: transparent;
    color: var(--color-accent);
}
.drawer-tab-btn .icon { width: 20px; height: 20px; }

/* PAINEL CENTRAL RESPONSIVO */
.panel {
  position: absolute; left: 0; right: 0; top: 60px; bottom: 80px;
  padding: 0 28px; overflow-y: auto; overflow-x: hidden;
  display: flex; justify-content: center; z-index: 1;
  background: transparent;
}

#booksView {
  position: absolute;
  top: 0;
  bottom: 0;
  left: var(--hud-w);
  right: 0;
}

#booksFrame {
  position: absolute;
  inset: 0;
}

.panel.books-active {
  padding: 0;
}

#editorView {
  position: relative;
  width: 100%;
  display: flex;
  justify-content: center;
  overflow: visible;
}

#editorWrap {
  position: relative;
  width: min(70ch, 80vw);
  max-width: var(--content-max);
  min-height: 80vh;
  margin-top: 0;
  padding: 0 8px;
  overflow: visible;
}

#editor {
  width: 100%;
  min-height: 80vh;
  outline: none; caret-color: var(--color-accent);
  padding-bottom: 180px; line-height: 1.65;
  white-space: pre-wrap; word-break: break-word; overflow-wrap: break-word;
  position: relative;
  z-index: 1;
  overflow: visible;
  max-height: none;
  height: auto;
  text-align: left;
  border: none;
  padding: 10px 12px 180px;
}

/* CONTROLS (Correção de posição e tamanho) */
.controls {
  position: absolute; left: var(--hud-w); right: 0; bottom: 14px;
  min-height: var(--controls-h); display: flex; justify-content: center;
  z-index: 50; pointer-events: none; 
}

.controls-inner {
  display: flex; align-items: center; gap: 10px; padding: 0 16px;
  background: var(--bg-drawer-solid, var(--bg-drawer));
  background-image:
    radial-gradient(120% 110% at 12% 8%, rgba(255, 255, 255, 0.08), transparent 58%),
    radial-gradient(130% 120% at 88% 90%, rgba(0, 0, 0, 0.08), transparent 64%),
    repeating-linear-gradient(
      10deg,
      rgba(0, 0, 0, 0.022) 0px,
      rgba(0, 0, 0, 0.022) 1px,
      rgba(255, 255, 255, 0.018) 1px,
      rgba(255, 255, 255, 0.018) 4px
    );
  border: none;
  box-shadow: none;
  border-radius: 999px;
  position: relative;
  
  pointer-events: auto;
  
  /* SEGREDO DA LINHA ÚNICA */
  flex-wrap: nowrap;
  white-space: nowrap;
  overflow-x: auto;
  overflow-y: hidden;
  row-gap: 6px;
  column-gap: 10px;
  
  width: auto; max-width: calc(96vw - var(--hud-w)); /* evita colisão com HUD */
  height: auto;
  min-height: var(--controls-h);
  
  backdrop-filter: none; 
}
.controls-inner > * {
  flex-shrink: 0;
}
.controls-inner::-webkit-scrollbar { display: none; }

.controls-inner .btn,
.controls-inner .btn-icon {
  min-height: var(--controls-h);
}
.controls-inner::-webkit-scrollbar { display: none; }

/* RE-LAYOUT 2030 (desktop): vazio ativo + rail/stage/utility */
@media (min-width: 901px) {
    body.layout-2030 #frame {
        inset: clamp(12px, 1.8vw, 24px);
        display: grid;
        grid-template-columns: clamp(56px, 4.8vw, 68px) minmax(0, 1fr) 0;
        grid-template-rows: auto minmax(0, 1fr) auto;
        gap: clamp(16px, 2vw, 30px);
        transition: grid-template-columns 260ms cubic-bezier(0.22, 0.61, 0.36, 1);
    }
    body.layout-2030.drawer-open #frame {
        grid-template-columns: clamp(56px, 4.8vw, 68px) minmax(0, 1fr) clamp(280px, 23vw, 360px);
    }

    body.layout-2030 .logo-area {
        position: relative;
        top: auto;
        left: auto;
        right: auto;
        grid-column: 2 / 4;
        grid-row: 1;
        height: auto;
        min-height: 30px;
        align-self: start;
        justify-self: start;
        margin-top: 0;
        padding-left: clamp(24px, 4.5vw, 88px);
    }

    body.layout-2030 .hud {
        position: relative;
        left: auto;
        right: auto;
        top: auto;
        bottom: auto;
        grid-column: 1;
        grid-row: 2 / 4;
        width: clamp(56px, 4.8vw, 68px);
        min-width: 56px;
        align-self: start;
        padding: 10px 8px;
        gap: 7px;
        border-radius: 16px;
        background: color-mix(in srgb, var(--bg-core) 88%, transparent);
        box-shadow: 0 18px 36px rgba(0, 0, 0, 0.05);
    }
    body.layout-2030 .hud-separator {
        width: 16px;
        margin: 2px auto;
        opacity: 0.22;
    }

    body.layout-2030 .panel {
        position: relative;
        left: auto;
        right: auto;
        top: auto;
        bottom: auto;
        grid-column: 2;
        grid-row: 2;
        padding: clamp(12px, 1.8vw, 22px) clamp(14px, 2.2vw, 28px) clamp(10px, 1.6vw, 18px);
        border: 1px solid color-mix(in srgb, var(--color-text) 9%, transparent);
        border-radius: 14px;
        background: color-mix(in srgb, var(--bg-core) 80%, transparent);
        box-shadow: 0 16px 30px rgba(0, 0, 0, 0.03);
    }

    body.layout-2030 #editorWrap {
        width: min(60ch, 54%);
        margin-left: clamp(26px, 6.2vw, 110px);
        margin-top: clamp(56px, 12vh, 154px);
    }

    body.layout-2030 #editor {
        font-size: clamp(15px, 1.02vw, 18px);
        line-height: 1.76;
        letter-spacing: 0.002em;
        text-wrap: pretty;
    }

    body.layout-2030 .controls {
        position: relative;
        left: auto;
        right: auto;
        bottom: auto;
        grid-column: 2;
        grid-row: 3;
        min-height: 0;
        justify-content: flex-start;
        padding-left: clamp(20px, 5vw, 96px);
        pointer-events: auto;
        opacity: 0.92;
        margin-bottom: 14px;
    }
    body.layout-2030 .controls-inner {
        background: color-mix(in srgb, var(--bg-core) 86%, transparent);
        background-image: none;
        border: 1px solid color-mix(in srgb, var(--color-text) 10%, transparent);
        border-radius: 14px;
        box-shadow: 0 10px 22px rgba(0, 0, 0, 0.05);
        padding: 0 8px;
        gap: 8px;
        opacity: 0.86;
        transition: opacity 220ms ease, transform 220ms ease;
    }
    body.layout-2030 .controls:hover .controls-inner,
    body.layout-2030 .controls-inner:focus-within {
        opacity: 1;
        transform: translateY(-1px);
    }
    body.layout-2030 .controls-inner .status-label {
        font-size: 11px;
        letter-spacing: 0.05em;
        opacity: 0.78;
    }
    body.layout-2030 .controls-inner .divider {
        opacity: 0.25;
    }
    body.layout-2030 .controls-inner .btn {
        min-height: 34px;
        padding: 6px 9px;
        font-size: 12px;
        opacity: 0.9;
    }
    body.layout-2030 .controls-inner .btn span {
        letter-spacing: 0.04em;
    }
    body.layout-2030 .controls-inner .search-wrapper {
        border: none;
        background: transparent;
    }

    body.layout-2030 .drawer {
        position: relative;
        left: auto;
        top: auto;
        bottom: auto;
        grid-column: 3;
        grid-row: 1 / 4;
        width: 100%;
        max-width: none;
        min-width: 0;
        height: auto;
        border-radius: 14px;
        border-right: none;
        box-shadow: 0 24px 45px rgba(0, 0, 0, 0.06);
        backdrop-filter: none;
        opacity: 0;
        pointer-events: none;
        transform: translateX(-10px);
        transition: opacity 220ms ease, transform 280ms cubic-bezier(0.22, 0.61, 0.36, 1);
        background: color-mix(in srgb, var(--bg-core) 90%, transparent);
        border: 1px solid color-mix(in srgb, var(--color-text) 10%, transparent);
    }
    body.layout-2030 .drawer::before {
        content: "MENU";
        position: absolute;
        left: -16px;
        top: 18px;
        width: 14px;
        height: 62px;
        border-radius: 10px;
        display: grid;
        place-items: center;
        font-size: 9px;
        letter-spacing: 0.2em;
        color: color-mix(in srgb, var(--color-text) 60%, transparent);
        background: color-mix(in srgb, var(--bg-core) 84%, transparent);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
        writing-mode: vertical-rl;
        text-orientation: mixed;
        opacity: 0;
        transition: opacity 220ms ease;
        pointer-events: none;
    }
    body.layout-2030 .drawer.open {
        opacity: 1;
        pointer-events: auto;
        width: 100%;
        border-right: none;
        box-shadow: 0 24px 45px rgba(0, 0, 0, 0.06);
        transform: translateX(0);
    }
    body.layout-2030 .drawer.open::before {
        opacity: 1;
        background: #2f5bff;
        color: rgba(255, 255, 255, 0.92);
        box-shadow: 0 14px 28px rgba(47, 91, 255, 0.28);
    }

    body.layout-2030 .drawer-header {
        min-height: 56px;
        border-bottom: 1px solid color-mix(in srgb, var(--color-text) 14%, transparent);
        justify-content: flex-start;
        padding-inline: 18px;
    }

    body.layout-2030 #drawerTitle {
        font-size: clamp(13px, 0.95vw, 16px);
        letter-spacing: 0.08em;
        font-weight: 500;
        opacity: 0.86;
    }

    body.layout-2030 #booksView {
        left: auto;
        right: auto;
        top: auto;
        bottom: auto;
        grid-column: 2;
        grid-row: 2 / 4;
        position: relative;
        border-radius: 18px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.03);
    }
}

/* STEP 3: escala tipográfica e ritmo por breakpoint desktop */
@media (min-width: 901px) and (max-width: 1279px) {
    body.layout-2030 #editorWrap {
        width: min(62ch, 56%);
        margin-top: clamp(52px, 10vh, 120px);
    }
    body.layout-2030 #editor {
        font-size: clamp(14px, 0.98vw, 16px);
        line-height: 1.74;
    }
}

@media (min-width: 1280px) {
    body.layout-2030 #editorWrap {
        width: min(56ch, 46%);
        margin-top: clamp(72px, 14vh, 186px);
    }
    body.layout-2030 #editor {
        font-size: clamp(16px, 1.08vw, 19px);
        line-height: 1.82;
    }
}

/* Desktop fallback scale: preserve horizontal layout below 1200x700 without page scroll */
body.desktop-locked.desktop-scaled #frame {
    inset: auto !important;
    left: 50% !important;
    top: 50% !important;
    right: auto !important;
    bottom: auto !important;
    width: calc(100vw - 24px) !important;
    height: calc(100vh - 24px) !important;
    min-width: 1200px !important;
    min-height: 700px !important;
    transform: translate(-50%, -50%) scale(var(--desktop-scale, 1)) !important;
}

/* MOBILE */
@media (max-width: 900px) {
    .hud { transform: translateX(calc(-100% - 14px)); background: var(--bg-drawer); border-right: var(--border-style); height: 100%; top: 0; bottom: 0; left: 0; width: 56px; }
    .mobile-trigger { display: flex; opacity: 0.6; pointer-events: auto; }
    .hud.mobile-open { transform: translateX(0); box-shadow: 5px 0 50px rgba(0,0,0,0.5); }
    .drawer { left: 0; width: 0; top: 0; bottom: 0; border-radius: 0; }
    .drawer.open { width: calc(100vw - 24px); }
    #editorWrap { width: 92vw; margin-top: 8px; }
    #booksView { left: 0; }
    .logo-area { display: none; }
    .panel { top: 10px; bottom: 10px; padding: 0 14px; }
    .controls { display: none; }
    .mobile-controls-trigger { display: none; }
    .controls-inner { display: none; }
    body.mobile-controls-open .controls-inner {
        display: flex;
        position: fixed;
        inset: 0;
        z-index: 80;
        padding: 24px;
        gap: 14px;
        flex-wrap: wrap;
        align-content: flex-start;
        justify-content: center;
        max-width: 100vw;
        max-height: 100vh;
        overflow-y: auto;
    }
    body.mobile-controls-open .mobile-controls-trigger { opacity: 0; pointer-events: none; }
    body.mobile-controls-open .mobile-controls-close { display: inline-flex !important; }
    body.mobile-controls-open .controls-inner .status-label { display: block; }
    body.mobile-controls-open .controls-inner .search-wrapper {
        min-width: 100%;
        max-width: 100%;
        flex: 1 1 100%;
        order: 0;
    }
    body.mobile-controls-open .controls-inner .btn span { display: inline; }
    body.mobile-controls-open .controls-inner .btn { padding: 8px 10px; min-width: 44px; font-size: 11px; }
    body.mobile-controls-open .controls-inner .btn-icon { width: 34px; height: 34px; }
    body.mobile-controls-open .controls-inner .search-input { font-size: 13px; }
    .drawer.mobile-all { width: calc(100vw - 24px); top: 0; bottom: 0; border-radius: 0; }
    .drawer.mobile-all .drawer-tabs-mobile { display: none; }
    .drawer.mobile-all .drawer-content { display: block !important; opacity: 1; }
    .drawer.mobile-all .drawer-content + .drawer-content { border-top: var(--border-style); }
    .drawer.mobile-all { overflow-y: auto; }
    .drawer.mobile-all .drawer-header { position: sticky; top: 0; background: var(--bg-drawer); z-index: 2; }
    .mobile-memo-actions { display: block; }
    .mobile-only { display: block; }
    .desktop-only { display: none; }
    body.mobile-lite #editorView { display: none; }
    body.mobile-lite #booksView { display: none; }
    body.mobile-lite .controls { display: none; }
    body.mobile-lite .logo-area { display: none; }
    body.mobile-lite .panel { top: 0; bottom: 0; padding: 0 14px; }
    body.mobile-lite .drawer { left: 0; }
    body.mobile-lite #mobileTabNav,
    body.mobile-lite #mobileTabFiles,
    body.mobile-lite #mobileTabTheme,
    body.mobile-lite #mobileTabBooks,
    body.mobile-lite #panelNav,
    body.mobile-lite #panelFiles,
    body.mobile-lite #panelActions { display: none !important; }
    body.mobile-lite .drawer-search { display: none; }
    body.mobile-lite #panelFiles .file-actions { flex-wrap: wrap; }
    body.mobile-lite #btnScanQr { order: -1; }
    .drawer-tabs-mobile {
        display: flex;
        gap: 10px;
        padding: 10px 14px;
        border-bottom: var(--border-style);
        justify-content: space-between;
    }
    .notes-panel {
        left: 0;
        width: 100vw;
    }

    body.desktop-locked .hud {
        transform: none;
        background: transparent;
        border-right: none;
        height: auto;
        top: 80px;
        bottom: 80px;
        left: 0;
        width: var(--hud-w);
    }
    body.desktop-locked .mobile-trigger,
    body.desktop-locked .mobile-controls-trigger {
        display: none !important;
        opacity: 0 !important;
        pointer-events: none !important;
    }
    body.desktop-locked .drawer {
        left: var(--hud-w);
        top: 80px;
        bottom: 80px;
        border-radius: 0 var(--radius) var(--radius) 0;
    }
    body.desktop-locked .drawer.open,
    body.desktop-locked .drawer.mobile-all {
        width: var(--drawer-w);
        border-radius: 0 var(--radius) var(--radius) 0;
    }
    body.desktop-locked .logo-area {
        display: flex;
    }
    body.desktop-locked #booksView {
        left: var(--hud-w);
    }
    body.desktop-locked .panel {
        top: 60px;
        bottom: 80px;
        padding: 0 28px;
    }
    body.desktop-locked #editorWrap {
        width: min(70ch, 80vw);
        margin-top: 0;
    }
    body.desktop-locked .controls {
        display: flex;
        left: var(--hud-w);
        right: 0;
        bottom: 14px;
    }
    body.desktop-locked .controls-inner {
        display: flex;
    }
}
